
 -- counts per set: total cards, cards with >=1 price row, cards with no price rows
 SELECT
   c.set_code,
   COUNT(*) AS total_cards,
   COUNT(DISTINCT p.card_id) AS cards_with_price,
   COUNT(*) - COUNT(DISTINCT p.card_id) AS cards_without_price
 FROM card c
 LEFT JOIN price p ON p.card_id = c.id
 GROUP BY c.set_code
 ORDER BY cards_without_price DESC, c.set_code;
 set_code | total_cards | cards_with_price | cards_without_price 
----------+-------------+------------------+---------------------
 cmm      |        1067 |              893 |                 174
 2x2      |         579 |              419 |                 160
 cmr      |         718 |              617 |                 101
 acr      |         307 |              213 |                  94
 mul      |         260 |              171 |                  89
 clb      |         936 |              850 |                  86
 sld      |        2250 |             2185 |                  65
 mat      |         230 |              180 |                  50
 ltc      |         588 |              558 |                  30
 mh3      |         524 |              499 |                  25
 ltr      |         854 |              833 |                  21
 rvr      |         531 |              510 |                  21
 dmc      |         240 |              220 |                  20
 brr      |         189 |              170 |                  19
 m3c      |         398 |              386 |                  12
 snc      |         467 |              458 |                   9
 ecl      |          33 |               27 |                   6
 frf      |         191 |              185 |                   6
 mkm      |         451 |              445 |                   6
 tmc      |          12 |                6 |                   6
 fin      |         594 |              589 |                   5
 pip      |        1068 |             1063 |                   5
 scd      |         352 |              347 |                   5
 slp      |          47 |               42 |                   5
 vow      |         412 |              407 |                   5
 who      |        1138 |             1133 |                   5
 40k      |         617 |              613 |                   4
 leg      |         310 |              306 |                   4
 mom      |         387 |              383 |                   4
 pewk     |           8 |                4 |                   4
 plst     |        4982 |             4978 |                   4
 pmei     |          38 |               34 |                   4
 pw25     |          17 |               13 |                   4
 5ed      |         456 |              453 |                   3
 arn      |          92 |               89 |                   3
 emn      |         208 |              205 |                   3
 pspl     |           7 |                4 |                   3
 4ed      |         379 |              377 |                   2
 6ed      |         350 |              348 |                   2
 hho      |          22 |               20 |                   2
 inv      |         352 |              350 |                   2
 mar      |          42 |               40 |                   2
 purl     |          14 |               12 |                   2
 spm      |         288 |              286 |                   2
 tla      |         394 |              392 |                   2
 tle      |         319 |              317 |                   2
 2ed      |         302 |              301 |                   1
 3ed      |         306 |              305 |                   1
 7ed      |         705 |              704 |                   1
 atq      |         102 |              101 |                   1
 ddf      |          79 |               78 |                   1
 eld      |         398 |              397 |                   1
 fca      |          65 |               64 |                   1
 gpt      |         167 |              166 |                   1
 lci      |         415 |              414 |                   1
 lea      |         295 |              294 |                   1
 leb      |         302 |              301 |                   1
 mid      |         392 |              391 |                   1
 mir      |         351 |              350 |                   1
 ody      |         352 |              351 |                   1
 ogw      |         187 |              186 |                   1
 ons      |         351 |              350 |                   1
 p30m     |           5 |                4 |                   1
 pal99    |          10 |                9 |                   1
 pfdn     |          93 |               92 |                   1
 pfin     |          94 |               93 |                   1
 pgpx     |          20 |               19 |                   1
 pjse     |           8 |                7 |                   1
 pkhm     |         157 |              156 |                   1
 ppro     |          17 |               16 |                   1
 pspm     |          69 |               68 |                   1
 psus     |          18 |               17 |                   1
 pw23     |          11 |               10 |                   1
 pzen     |           4 |                3 |                   1
 spg      |         134 |              133 |                   1
 stx      |         383 |              382 |                   1
 


-- Count of cards grouped by set.type (includes set types with zero cards)
SELECT
  s.type,
  COUNT(c.id) AS card_count
FROM "set" s
LEFT JOIN card c ON c.set_code = s.code
GROUP BY s.type
ORDER BY card_count DESC;

       type       | card_count 
------------------+------------
 expansion        |      29523
 commander        |      14104
 masters          |      11489
 core             |       9626
 promo            |       8024
 draft_innovation |       7761
 box              |       4590
 memorabilia      |       2756
 funny            |       2187
 duel_deck        |       1838
 masterpiece      |       1424
 starter          |        926
 planechase       |        647
 eternal          |        430
 archenemy        |        321
 from_the_vault   |        155
 premium_deck     |        105
 arsenal          |         34
 vanguard         |         32
 spellbook        |         2
LEFT JOIN price p ON p.card_id = c.id
GROUP BY c.set_code;

-- Get all sets base_size and number of cards in set 
SELECT
s.code,
s.name,
s.base_size,
COUNT(c.id) AS card_count,
s.release_date,
s.type
FROM "set" s
LEFT JOIN card c ON c.set_code = s.code
GROUP BY s.code, s.name, s.base_size, s.release_date, s.type
ORDER BY s.code;


WITH non_ascii_chars AS (
    SELECT
        c.id,
        c.set_code,
        unnest(string_to_array(regexp_replace(c.number, '[\x00-\x7F]', '', 'g'), '')) AS ch
    FROM card c
    WHERE c.number ~ '[^\x00-\x7F]'
),
filtered AS (
    SELECT DISTINCT id, set_code, ch
    FROM non_ascii_chars
)
SELECT
    ch AS non_ascii_character,
    COUNT(DISTINCT id) AS card_count,
    COUNT(DISTINCT set_code) AS set_count
FROM filtered
GROUP BY ch
ORDER BY ch;
 non_ascii_character | card_count | set_count 
---------------------+------------+-----------
 Φ                   |          4 |         1
 †                   |         72 |        20
 ★                   |       1878 |        90
(3 rows)


------
-- ****************************************
-- * SETS with CARDS with NON-ASCII Chars *
-- ****************************************
SELECT
  s.code,
  s.name, s.base_size,
  COUNT(c.id) AS non_ascii_count
FROM "set" s
JOIN card c ON c.set_code = s.code
WHERE c.number ~ '[^\x00-\x7F]'
GROUP BY s.code, s.name
HAVING COUNT(c.id) > 0
ORDER BY non_ascii_count DESC, s.code;


 code  |               name               | base_size | non_ascii_count |    type       | dupes action  
-------+----------------------------------+-----------+-----------------+-------------  +------------
 sld   | Secret Lair Drop                 |         1 |             123 | box           | * * * TODO * * *
 plst  | The List                         |      5075 |               3 | masters       | * * * TODO * * *
 4ed   | Fourth Edition                   |       378 |               1 | core          | (check with JQ - reorder if legit [misprint])

 fin   | Final Fantasy                    |       309 |               4 | expansion     | delete or reorder cross 
 40k   | Warhammer 40,000 Commander       |       617 |             296 | commander     | delete
 7ed   | Seventh Edition                  |       350 |             350 | core          | delete
 8ed   | Eighth Edition                   |       350 |             350 | core          | delete
 9ed   | Ninth Edition                    |       350 |             350 | core          | delete
 10e   | Tenth Edition                    |       383 |             125 | core          | delete

 dkm   | Deckmasters                      |        50 |               2 | box           | merge delete (star)
 unh   | Unhinged                         |       140 |              27 | funny         | merge delete
 frf   | Fate Reforged                    |       185 |               6 | expansion     | merge delete
 ons   | Onslaught                        |       350 |               1 | expansion     | merge delete (star)
 shm   | Shadowmoor                       |       301 |               1 | expansion     | merge delete (star)
 stx   | Strixhaven: School of Mages      |       275 |               1 | expansion     | merge delete (star)
 thb   | Theros Beyond Death              |       254 |               1 | expansion     | merge delete (star)

 war   | War of the Spark                 |       264 |              36 | expansion     | reorder
 arn   | Arabian Nights                   |        78 |              14 | expansion     | reorder (cross)
 mkm   | Murders at Karlov Manor          |       286 |              11 | expansion     | reorder (cross)
 soi   | Shadows over Innistrad           |       297 |               5 | expansion     | reorder (cross with [a|b|c|d|e])
 kld   | Kaladesh                         |       264 |               4 | expansion     | reorder
 aer   | Aether Revolt                    |       184 |               3 | expansion     | reorder (cross)
 drk   | The Dark                         |       119 |               3 | expansion     | reorder (cross)
 pls   | Planeshift                       |       143 |               3 | expansion     | reorder (star)
 atq   | Antiquities                      |       100 |               2 | expansion     | reorder (cross)
 mir   | Mirage                           |       350 |               1 | expansion     | reorder (cross - misprint)
 ogw   | Oath of the Gatewatch            |       184 |               1 | expansion     | reorder (cross) (keep a)
 gpt   | Guildpact                        |       165 |               2 | expansion     | reorder (star)
 inv   | Invasion                         |       350 |               2 | expansion     | reorder (star)
 ody   | Odyssey                          |       350 |               2 | expansion     | reorder (cross - misprints)
 dd2   | Duel Decks: Jace vs. Chandra     |        62 |               2 | duel_deck     | reorder (star)
 hho   | Happy Holidays                   |        21 |               2 | funny         | reorder (cross)
 fca   | Final Fantasy: Through the Ages  |         0 |               1 | masterpiece   | reorder (cross - misprint)
 por   | Portal                           |       243 |               7 | starter       | reorder (d|s|cross)
 5ed   | Fifth Edition                    |       455 |               5 | core          | reorder 
 m20   | Core Set 2020                    |       280 |               1 | core          | reorder (cross - misprint)
 j14   | Judge Gift Cards 2014            |         9 |               5 | promo         | reorder (looks like 2 different sets in one)
 p30h  | 30th Anniversary History Promos  |        10 |               5 | promo         | reorder
 
 pwar  | War of the Spark Promos          |       176 |              33 | promo         | keep | reorder
 pwwk  | Worldwake Promos                 |         6 |               2 | promo         | keep | reorder
 pbng  | Born of the Gods Promos          |         9 |               7 | promo         | keep 
 pgtc  | Gatecrash Promos                 |        10 |               7 | promo         | keep
 pjou  | Journey into Nyx Promos          |        10 |               7 | promo         | keep
 prtr  | Return to Ravnica Promos         |        10 |               7 | promo         | keep
 pths  | Theros Promos                    |        10 |               7 | promo         | keep
 pkhm  | Kaldheim Promos                  |         1 |               5 | promo         | keep
 pm13  | Magic 2013 Promos                |         6 |               5 | promo         | keep
 pm14  | Magic 2014 Promos                |         6 |               5 | promo         | keep
 psdc  | San Diego Comic-Con 2013         |         5 |               5 | promo         | keep
 pdgm  | Dragon's Maze Promos             |         6 |               4 | promo         | keep
 pmbs  | Mirrodin Besieged Promos         |         4 |               4 | promo         | keep
 pavr  | Avacyn Restored Promos           |         6 |               3 | promo         | keep
 pdka  | Dark Ascension Promos            |         5 |               3 | promo         | keep
 pm10  | Magic 2010 Promos                |         3 |               3 | promo         | keep
 pm11  | Magic 2011 Promos                |         6 |               3 | promo         | keep
 pm12  | Magic 2012 Promos                |         3 |               3 | promo         | keep
 pmid  | Innistrad: Midnight Hunt Promos  |       171 |               3 | promo         | keep
 pnph  | New Phyrexia Promos              |         4 |               3 | promo         | keep
 proe  | Rise of the Eldrazi Promos       |         4 |               3 | promo         | keep
 psom  | Scars of Mirrodin Promos         |         4 |               3 | promo         | keep
 pzen  | Zendikar Promos                  |         5 |               3 | promo         | keep
 p30m  | 30th Anniversary Misc Promos     |         5 |               2 | promo         | keep
 parb  | Alara Reborn Promos              |         3 |               2 | promo         | keep
 pbok  | Betrayers of Kamigawa Promos     |         2 |               2 | promo         | keep
 pcon  | Conflux Promos                   |         2 |               2 | promo         | keep
 pdis  | Dissension Promos                |         2 |               2 | promo         | keep
 peld  | Throne of Eldraine Promos        |       152 |               2 | promo         | keep
 peve  | Eventide Promos                  |         2 |               2 | promo         | keep
 pfut  | Future Sight Promos              |         2 |               2 | promo         | keep
 pgpt  | Guildpact Promos                 |         2 |               2 | promo         | keep
 pisd  | Innistrad Promos                 |         5 |               2 | promo         | keep
 plrw  | Lorwyn Promos                    |         3 |               2 | promo         | keep
 pmor  | Morningtide Promos               |         2 |               2 | promo         | keep
 pneo  | Kamigawa: Neon Dynasty Promos    |       157 |               2 | promo         | keep
 pplc  | Planar Chaos Promos              |         2 |               2 | promo         | keep
 prav  | Ravnica: City of Guilds Promos   |         2 |               2 | promo         | keep
 pshm  | Shadowmoor Promos                |         2 |               2 | promo         | keep
 psok  | Saviors of Kamigawa Promos       |         2 |               2 | promo         | keep
 ptsp  | Time Spiral Promos               |         3 |               2 | promo         | keep
 pvow  | Innistrad: Crimson Vow Promos    |       137 |               2 | promo         | keep
 p5dn  | Fifth Dawn Promos                |         1 |               1 | promo         | keep
 p8ed  | Eighth Edition Promos            |         1 |               1 | promo         | keep
 p9ed  | Ninth Edition Promos             |         2 |               1 | promo         | keep
 pakh  | Amonkhet Promos                  |        77 |               1 | promo         | keep
 pal99 | Arena League 1999                |       350 |               1 | promo         | keep
 pala  | Shards of Alara Promos           |         2 |               1 | promo         | keep
 pbfz  | Battle for Zendikar Promos       |        90 |               1 | promo         | keep
 pchk  | Champions of Kamigawa Promos     |         1 |               1 | promo         | keep
 pcns  | Conspiracy Promos                |         1 |               1 | promo         | keep
 pcsp  | Coldsnap Promos                  |         1 |               1 | promo         | keep
 pdmu  | Dominaria United Promos          |       161 |               1 | promo         | keep
 pdst  | Darksteel Promos                 |         1 |               1 | promo         | keep
 pemn  | Eldritch Moon Promos             |        77 |               1 | promo         | keep
 pfrf  | Fate Reforged Promos             |        43 |               1 | promo         | keep
 pgrn  | Guilds of Ravnica Promos         |        84 |               1 | promo         | keep
 piko  | Ikoria: Lair of Behemoths Promos |       137 |               1 | promo         | keep
 pkld  | Kaladesh Promos                  |        83 |               1 | promo         | keep
 pl21  | Year of the Ox 2021              |         4 |               1 | promo         | keep
 pm15  | Magic 2015 Promos                |        14 |               1 | promo         | keep
 pm19  | Core Set 2019 Promos             |        95 |               1 | promo         | keep
 pm21  | Core Set 2021 Promos             |       137 |               1 | promo         | keep
 pmrd  | Mirrodin Promos                  |         1 |               1 | promo         | keep
 pori  | Magic Origins Promos             |        54 |               1 | promo         | keep
 prix  | Rivals of Ixalan Promos          |        98 |               1 | promo         | keep
 prna  | Ravnica Allegiance Promos        |        81 |               1 | promo         | keep
 psnc  | Streets of New Capenna Promos    |       161 |               1 | promo         | keep
 psoi  | Shadows over Innistrad Promos    |        89 |               1 | promo         | keep
 pthb  | Theros Beyond Death Promos       |       137 |               1 | promo         | keep
 pulg  | Urza's Legacy Promos             |         1 |               1 | promo         | keep
 punh  | Unhinged Promos                  |         1 |               1 | promo         | keep
 pznr  | Zendikar Rising Promos           |       169 |               1 | promo         | keep
 