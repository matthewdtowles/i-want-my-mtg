<div class="login-container">
    <h3 class="page-title">Reset Your Password</h3>
    <p class="page-subtitle">Enter your new password below.</p>
    {{#if error}}
    <div class="bg-error p-4 rounded mb-4">
        <p>{{error}}</p>
    </div>
    {{/if}}
    <form id="reset-password-form" class="mt-6" action="/auth/reset-password" method="post" novalidate>
        <input type="hidden" name="token" value="{{token}}" />
        <div class="mb-4">
            <label class="input-label" for="new-password">New Password</label>
            <input id="new-password" class="input-field" type="password" name="password" required minlength="8" maxlength="128" />
            <p class="password-requirements">Min 8 characters: 1 uppercase, 1 lowercase, 1 number, 1 special character</p>
        </div>
        <div class="mb-6">
            <label class="input-label" for="confirm-password">Confirm Password</label>
            <input id="confirm-password" class="input-field" type="password" name="confirmPassword" required />
        </div>
        <button id="reset-password-btn" class="btn btn-primary" type="submit">Reset Password</button>
    </form>
    <div class="mt-4 text-center">
        <a href="/auth/login" class="link">
            Back to Login
        </a>
    </div>
</div>
<script src="/public/js/form-validation.js"></script>
<script>
    (function () {
        var FV = window.FormValidator;
        var passwordEl = document.getElementById('new-password');
        var confirmEl = document.getElementById('confirm-password');

        FV.attachBlurValidation(passwordEl, FV.validatePassword);
        confirmEl.addEventListener('blur', function () {
            var error = FV.validatePasswordMatch(passwordEl.value, confirmEl.value);
            if (error) FV.showFieldError(confirmEl, error);
            else FV.clearFieldError(confirmEl);
        });
        confirmEl.addEventListener('input', function () {
            if (confirmEl.parentNode.querySelector('.field-error')) {
                var error = FV.validatePasswordMatch(passwordEl.value, confirmEl.value);
                if (error) FV.showFieldError(confirmEl, error);
                else FV.clearFieldError(confirmEl);
            }
        });

        document.getElementById('reset-password-form').addEventListener('submit', function (e) {
            var valid = true;
            if (!FV.validateField(passwordEl, FV.validatePassword)) valid = false;
            var matchError = FV.validatePasswordMatch(passwordEl.value, confirmEl.value);
            if (matchError) {
                FV.showFieldError(confirmEl, matchError);
                valid = false;
            } else {
                FV.clearFieldError(confirmEl);
            }
            if (!valid) e.preventDefault();
        });
    })();
</script>
